<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>My Utility Usage Report</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
<div class="container">
  <h2>My Utility Usage Report</h2>

  <table id="usageTable" border="1">
    <thead>
    <tr>
      <th>Appliance</th>
      <th>Utility Type</th>
      <th>Sub Category</th>
      <th>Units Used</th>
      <th>Usage Cost</th>
      <th>Date</th>
      <th>Notes</th>
      <th>Actions</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="usage : ${usages}">
      <th:block th:if="${editId} == ${usage.id}">
        <form th:id="'editForm_' + ${usage.id}" th:action="@{/report}" method="post">
          <input type="hidden" name="editId" th:value="${usage.id}" />
          <td><input type="text" name="appliance" th:value="${usage.appliance}" required /></td>
          <td>
            <select name="utilityType">
              <option value="Electricity" th:selected="${usage.utilityType == 'Electricity'}">Electricity</option>
              <option value="Water" th:selected="${usage.utilityType == 'Water'}">Water</option>
              <option value="Gas" th:selected="${usage.utilityType == 'Gas'}">Gas</option>
            </select>
          </td>
          <td><input type="text" name="subCategory" th:value="${usage.subCategory}" required /></td>
          <td><input type="number" name="unitsUsed" th:value="${usage.unitsUsed}" step="0.1" required /></td>
          <td><input type="number" name="usageCost" th:value="${usage.usageCost}" step="0.01" required /></td>
          <td><input type="date" name="date" th:value="${usage.date}" required /></td>
          <td><input type="text" name="notes" th:value="${usage.notes}" /></td>
          <td>
            <button type="submit" class="btn">Save</button>
            <a th:href="@{/report}" class="btn">Cancel</a>
          </td>
        </form>
      </th:block>
      <th:block th:unless="${editId} == ${usage.id}">
        <td th:text="${usage.appliance}"></td>
        <td th:text="${usage.utilityType}"></td>
        <td th:text="${usage.subCategory}"></td>
        <td th:text="${usage.unitsUsed}"></td>
        <td th:text="${usage.usageCost}"></td>
        <td th:text="${usage.date}"></td>
        <td th:text="${usage.notes}"></td>
        <td>
          <form th:action="@{/report}" method="post" style="display:inline;">
            <input type="hidden" name="editId" th:value="${usage.id}" />
            <button type="submit" class="btn">Edit</button>
          </form>
          <form th:action="@{/report/delete}" method="post" style="display:inline;">
            <input type="hidden" name="deleteId" th:value="${usage.id}" />
            <button type="submit" class="btn" style="background:#e74c3c;">Delete</button>
          </form>
        </td>
      </th:block>
    </tr>
    </tbody>
  </table>

  <!-- Success/Error Message -->
  <span th:if="${success}" style="color:green;">Update successful!</span>
  <span th:if="${error}" style="color:red;">Operation failed!</span>

  <!-- Bottom navigation -->
  <a href="/add-usage">Add More Usage</a> | <a href="/">Home</a>
</div>
</body>
</html>
